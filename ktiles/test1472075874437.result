"KÃ–LNER CONTINENTS"

1   2 1 2   2   4 2 6 8 5 2   5 5 1 9 6 2 9 3 2 1 11 13 7 7 9 7 7 7 6 7 10 11 12 11 13 8 6 9 9 7 13 8 3 3 8 9 5 8 10 9 12 11 10 14 14 17 15 15 18 22 18 14 15 12 12 12 14 16 9 12 12 17 11 12 12 11 14 13 13 14 14 11 14 14 11 14 14 11 14 14 11 14 13 10 2 
  1 2 1 2 1 1 3 4 3 5 7 5 3 8 4 5 12 10 8 10 6 1 3 5 9 6 6 11 10 11 13 9 10 13 13 11 10 9 9 7 3 4 4 7 7 5 2 5 8 4 5 8 4 7 12 9 7 12 10 13 22 21 18 17 13 10 7 10 11 8 14 12 7 8 9 7 7 8 7 8 8 6 8 9 6 6 8 6 6 8 6 6 8 6 6 8 5 2 1 
      1     1 2   1 1 3 3 2 3 2   1 3 4 2 1 1   1 3 2 2 4 5 4 1 6 5 7 4 4 1 1 1     1 1 1     1     1     1   2 3 2 1 6 5 2 7 5 6 3 1   1 1     1 1   1 2 1                                             
      2 2 1 5 5 3 4 7 7 3 4 3 3 2 2 4 5 5 4 2 1 4 9 8 4 4 3 6 8 5 6 14 13 9 6 4 1   2 1 2 4 3                 2 4 1 1 3 7 14 10 8 10 7 8 5 2 3 1 1   3 3 2 4 5 2 1   2 2   1 1   1   1 1   1 1   1 1   1     
    1 1 1 1   1 1 2 3 4 3 3 3 1 2 1 2 2 3 2     1 6 4 2   7 1 3 5 5 4 8 3 2 2             1                     2   1 5 4 6 8 8 2 2     1 1   3 1       1     1 2 1     1 1   1 1   1 1   1 1   1 1     
      2 4 3 3 5 3 6 3 4 4 7 2 3 1   5 6 5 3 1 1 7 9 3   2 4 7 6 11 11 11 11 9 5 3 1 1                             1   3 4 4 4 6 11 12 8 1 1   1 2 1 1 2               1   1 1 2 1 2 2 1 2 2 1 2 2 1 2 2 1     
            3 2 2 3 3 1 2 3 2 2   2 1 3 1         3 1   1 3 4 3 4 4 6 5 4 2 1           1                           1 4 3 1 7 8 2     1 1     1       1                                                 
        1 4 3 2 5 4 8 8 7 2 1 1 2 2 5 3 1 2     2 4 4 1 2 4 4 9 7 3 12 11 10 4 1 1       1   1                         3 4 4 4 13 8 5 5         2 1 1   1                                                   
      1 2 1 1 1 2 2 4 4 2 2 1       2   1       1 1 2     1 3 3 4 5 6 6 3 1                                             2 1   3 4                     1                                                 
      2 4 5 4 4 3 1 2 2 4 5 1 2     1 2   1     1 2 1 1   1 2 6 8 12 8 10 5 1                                           1 3 3 4 5 5 2   1             1   1                                               
    1 2 1 1 1   1 3 2 2 3   2   1 1                 1         3 5 8 5 5 1                                             1   1 2 5     1                                                                   
    1 3 4 2 3 6 5 2 3 6 7 5 2       1                       1 4 9 8 9 12 11 2                                             3 1 1 2   1                                                                     
      1 1 2 1 1 1 1 1 1 4 4 2 1                             1 3 1 4 9 5 2                                               1   2                                                                           
        2 5 3 2 2 4 7 5 5 2     2     1                       3 10 8 6 8 2 1                                               2 3 2 1                                                                       
        1     2 2 4 5 4 2                                     1 2 6 3 3 1                                                 1 2 1                                                                         
          4 4 4 2 4 6 2 4 2 1 1                             1   2 4 11 7 3                                                 1 1   1                                                                       
          1 2 3 1 1 1 3 1 4   2   1                             1 1 5 2                                                       1                                                                         
        1 2 7 5 5 2 7 4 7 5 1     2 1                           2 4 3 3                                                   1                                                                             
          1   1 1 2 3 6 3 1 2                                 1       2                                                                                                                                 
            4 3 3 3 5 6 5 4 3   1                               1     1                                                                                                                                 
            1 1 1 2 2 2 1 3 2 2                                                                                                                                                                         
          1 3 7 5 2 5 3 4 4 1 2 1   1                                   1                                                                                                                               
            1   1 3 1 3 2 2 1 1                                       1                                                                                                                                 
          1 3 4 5 2 1 4 7 6 3   1                                                                                                                                                                       
            2 3   2   2 6 4   1                                                                                                                                                                         
          2 4 6 3     5 6 4 5   1 1                                                                                                                                                                     
          1 1     2   3 2 2 2 1                                                                                                                                                                         
          1 4 7 6 2 6 4 3 2     1                                                                                                                                                                       
            1 3 2 3 5 3   2 1 1                                                                                                                                                                         
            3 3 4 6 6 7 7 2 2 1   1                                                                                                                                                                     
            2 3 2 2 6 6 1 1                                                                                                                                                                             
          2 3 5 4 4 6 8 4   3 1 1                                                                                                                                                                       
          1 1 1 2 2 3 1 1 2   2                                                                                                                                                                         
          1 5 2 2 5 6 5 4 6 2       1                                                                                                                                                                   
        2 2 2 2   1 1 4 2 4 5 1                                                                                                                                                                         
      2 4 4 2 3 5 3 4 4 4 2 2 1                                                                                                                                                                         
            1     3 5 1 2   2   1                                                                                                                                                                       
      1 1 1 4 4 4 4 5 9 2 3 9 5 2 1                                                                                                                                                                     
      1 1 1 2 2 1 3 2 1 2 2 3 4                                                                                                                                                                         
        1 1 3 5 5 5 7 3 1 4 2 1                                                                                                                                                                         
            1   1 2 3 3 1 1 4 1                                                                                                                                                                         
              5 4 4 5 3 4 3 5 3 1 1                                                                                                                                                                     
              1 2 4 5 4 1 4 1 2                                                                                                                                                                         
            1 2 5 5 7 9 5 1 1 3 3                                                                                                                                                                       
        2 2 2 2 1 2 3 2 2 2 1 1                                                                                                                                                                         
      2 4 5 3 2 2 7 6 2 3 2 1                                                                                                                                                                           
            1   1 2 4 2 1 3   1                                                                                                                                                                         
      1 1 2 2 1 3 5 6 6 5   2 1                                                                                                                                                                         
      1 2 2       4 3 3 1 1                                                                                                                                                                             
        4 4 3 1 5 6 9 4 1 4 1   1                                                                                                                                                                       
          1     2 7 4 1 1 2 2                                                                                                                                                                           
        1 4 2 2 4 7 7 2 1 1                                                                                                                                                                             
        1 1 2 2 1 2 3 3 2 1   1                                                                                                                                                                         
          1 2 1 3 7 4 5 6 1 2 1                                                                                                                                                                         
          1 1 2 2 2 3 2 4 2                                                                                                                                                                             
          1 4 5 3 5 9 6 4 2 2   1                                                                                                                                                                       
                1 3 4 3 2 3                                                                                                                                                                             
              1 4 2 2 4 5 2 1                                                                                                                                                                           
            2 2   1 2 2 2 3   1                                                                                                                                                                         
            2 5 5 2 1 3 5 5 2 1                                                                                                                                                                         
                  3     3 3 2                                                                                                                                                                           
              4 6 3 5 5 5 3 3   1                                                                                                                                                                       
              2 2 3 1 4 5 3   1                                                                                                                                                                         
            1 1 7 3 1 4 8 3 1 1                                                                                                                                                                         
              1 1 4 2 1 2 4 1                                                                                                                                                                           
                2 6 3 2 2 1                                                                                                                                                                             
                3 1 3 2                                                                                                                                                                                 
              1 4 7 1 2 1   1                                                                                                                                                                           
        2 2 2 2 2 3 2     1                                                                                                                                                                             
      2 4 5 3 2 3 1 2 2 1                                                                                                                                                                               
            1     1 1                                                                                                                                                                                   
      1 1 2 3 1   1 1 1                                                                                                                                                                                 
      1 2 2   1   1 1                                                                                                                                                                                   
        4 5 4 4 1   2                                                                                                                                                                                   
          1     1     1                                                                                                                                                                                 
        1 4 2 2 3 1                                                                                                                                                                                     
        1 1 2 4 2 2                                                                                                                                                                                     
          1 4 5 5 2 1                                                                                                                                                                                   
          1       1 1                                                                                                                                                                                   
            2 1 1   1                                                                                                                                                                                   
            1   1 1                                                                                                                                                                                     
              1 1 1                                                                                                                                                                                     
                                                                                                                                                                                                        
                                                                                                                                                                                                        
                                                                                                                                                                                                        
                                                                                                                                                                                                        
                                                                                                                                                                                                        
                                                                                                                                                                                                        
                                                                                                                                                                                                        
                                                                                                                                                                                                        
                                                                                                                                                                                                        
                                                                                                                                                                                                        
                                                                                                                                                                                                        
                                                                                                                                                                                                        
                                                                                                                                                                                                        
                                                                                                                                                                                                        
                                                                                                                                                                                                        
                                                                                                                                                                                                        
                                                                                                                                                                                                        
                                                                                                                                                                                                        
____________________________

package org.ag.ktiles;

import org.apache.commons.lang3.tuple.ImmutablePair;

import java.io.File;
import java.io.IOException;
import java.io.PrintWriter;
import java.nio.charset.Charset;
import java.nio.file.Files;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.List;

public class Main {
    private int xDim = 100;
    private int yDim = 100;
    private int[] currentRhombus = {0, 0};
    private int currentDir = 10;
    private String filename = "test" + System.currentTimeMillis() + ".result";

    public static void main(String[] args) throws InterruptedException, IOException {
        new Main().run();
    }

    private void run() throws InterruptedException, IOException {
        /* Initialize the tile */

        List<Rhombus> koelnerTile = new ArrayList<>();

        for (int i = 0; i < xDim; i++) {
            for (int j = 0; j < yDim; j++) {
                koelnerTile.add(new Rhombus(i, j));
            }
        }



        /* Run the steps */
        for (int i = 0; i < 10000; i++) {
            step(koelnerTile);
//            Thread.sleep(1000);
//            disp(koelnerTile);
        }

        disp(koelnerTile);
    }

    private void disp(List<Rhombus> koelnerTile) throws IOException {
        System.out.println("Saving...");
        PrintWriter writer = new PrintWriter(filename, "UTF-8");
        writer.println("\"NAMEOFRESULT\"");
        writer.println();
        for (int i = 0; i < xDim; i++) {
            for (int j = 0; j < yDim; j++) {
//                System.out.println("On rhombus " + (i * 1000 + j) + ".");
                Rhombus c = koelnerTile.get(getIndex(koelnerTile, new int[]{i, j}));
                if (c.getValue() != 0) {
                    writer.print(c.getValue() + " ");
                } else {
                    writer.print("  ");
                }
            }
            writer.println();
        }
        writer.println("____________________________");
        writer.println();
        List<String> list = Files.readAllLines(new File("C:\\development\\koelner\\ktiles\\src\\org\\ag\\ktiles\\Main.java").toPath(), Charset.defaultCharset());
        for (String line : list) {
            writer.println(line);
        }
        writer.close();
    }

    private List<Rhombus> step(List<Rhombus> koelnerTile) {
        System.out.println("Current coordinates are " + Arrays.toString(currentRhombus) + ".");
        System.out.println("Current direction is " + currentDir + ".");

        int currentIndex = getIndex(koelnerTile, currentRhombus);
        Rhombus current;
        try {
            current = koelnerTile.get(currentIndex);
        } catch (ArrayIndexOutOfBoundsException e) {
            return koelnerTile;
        }
        assert current != null;
        current.increment();

        ImmutablePair<Integer, Integer> neighborCoords = current.getNeighbor(currentDir);
        System.out.println("Neighbor's coordinates are " + neighborCoords + ".");

        // If the neighbor exists, switch to it
        if (neighborCoords != null) {
            currentRhombus[0] = neighborCoords.getLeft();
            currentRhombus[1] = neighborCoords.getRight();
        }

        updateDir();

        if (currentRhombus[0] % 2 == 0) {
            currentRhombus[0] += (int) (Math.floor(current.getValue())) - (int) (Math.floor(Math.sqrt(currentRhombus[1])));
            if (currentRhombus[0] < 0) {
                currentRhombus[0] = 0;
            }
        }

        return koelnerTile;
    }

    private void updateDir() {
        currentDir++;
        currentDir %= 4;
        currentDir += 10;
    }


    private int getIndex(List<Rhombus> koelnerTile, int[] coords) {
        for (Rhombus r : koelnerTile) {
            if (r.getX() == coords[0] && r.getY() == coords[1]) {
                return koelnerTile.indexOf(r);
            }
        }

        return -1;
    }
}
